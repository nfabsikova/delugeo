<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8" />
        <title>Delugeo - Infrastructural: London Flood and Defenses</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
        <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css" rel="stylesheet">
        <link href="london-defenses.css" rel="stylesheet">

        <style type="text/css">
            @import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;700&display=swap');        

            body {
                margin: 0;
                padding: 0;
            }

            #map {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
            }
    
            .headBox {
                position: absolute;
                height: 48px;
                left: 0;
                top: 0;
                width: 100%;
                z-index: 9999;
                font-family: 'Work Sans', sans-serif;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                /* background-color: rgba(92, 55, 226, 0.61); */
                align-items: center;
                text-align: center;
            }
    
            .headText {
                font-size: 48px;
                color: #fff;
            }
        </style>
    </head>


<body>
    <!--<div id="map"></div>
    <script>
        mapboxgl.accessToken = 
            'pk.eyJ1IjoiaGVucnkxOCIsImEiOiJjbDBsMXUyczYwZDhiM2RwZXJkNnlteWhoIn0.wpRHBQ0CPPlYrt8cQLPmjg';
    // Load a new map in the 'map' HTML div
        var map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/henry18/cl0lknmce002q14pcjskq3m5l', // style URL
            center: [0.0, 51.4317], // starting position [lng, lat]
            zoom: 9.5 // starting zoom
        });
    </script>-->

    
    
    

    <div id="map"></div>

    
    <script>
        mapboxgl.accessToken =
                'pk.eyJ1IjoiaGVucnkxOCIsImEiOiJjbDBsMXUyczYwZDhiM2RwZXJkNnlteWhoIn0.wpRHBQ0CPPlYrt8cQLPmjg'; //Put your mapbox access token here
            // Load a new map in the 'map' HTML div
            var map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/henry18/cl0lknmce002q14pcjskq3m5l', // Put your mapbox style ID here
                center: [0.0049, 51.5051], // starting position [lng, lat]
                zoom: 12 // starting zoom
        });

        map.on('load', () => {
        

            map.addSource('LondonFloodRiskAreas', {
                type: 'vector',
                url: 'mapbox://henry18.9128ynra'
            });
            map.addLayer({
                'id': 'LondonFloodRiskAreas',
                'type': 'fill',
                'source': 'LondonFloodRiskAreas',
                'layout': {
                    // Make the layer visible by default.
                    'visibility': 'visible'
                },
                'paint': {
                    'fill-color': [
                            "match",
                            ["get", "PROB_4BAND"],
                            "Very Low", "#05aaf7",
                            "Low", "#0c5df4",
                            "Medium", "#6436e4",
                            "High", '#7609f2',
                            "#8e9292"

                            ],
                            'fill-outline-color': '#343434',
                            'fill-opacity': 0.7
                },
                'source-layer': 'ROFRS_London-cygxye'
            });

            map.addSource('HistoricalFlood', {
                type: 'vector',
                url: 'mapbox://henry18.95o6m5g3'
            });
            map.addLayer({
                'id': 'HistoricalFlood',
                'type': 'fill',
                'source': 'HistoricalFlood',
                'layout': {
                    // Make the layer visible by default.
                    'visibility': 'none',
                    
                },
                'paint': {
                    'fill-color': "#ef0b0b",
                    'fill-outline-color': '#343434',
                    'fill-opacity': 0.7
                },
                'source-layer': 'EA_RecordedFloodOutlines_SHP-assd37'
            });

            map.addSource('FloodDefence', {
                type: 'vector',
                url: 'mapbox://henry18.7fehb1y3'
            });
            map.addLayer({
                'id': 'FloodDefence',
                'type': 'line',
                'source': 'FloodDefence',
                'layout': {
                    // Make the layer visible by default.
                    'visibility': 'none',
                    "line-join": "round",
                    "line-cap": "round"
                },
                'paint': {
                    "line-color": "#d3f705",
                "line-width": 2,
                },
                'source-layer': 'Spatial_Flood_Defences_Includ-7wt9un'
            });

            map.addSource('AreasBenefitingfromDefences', {
                type: 'vector',
                url: 'mapbox://henry18.2iuyom57'
            });
            map.addLayer({
                'id': 'AreasBenefitingfromDefences',
                'type': 'fill',
                'source': 'AreasBenefitingfromDefences',
                'layout': {
                    // Make the layer visible by default.
                    'visibility': 'none',
                    
                },
                'paint': {
                    'fill-color': "#00ff1e",
                    'fill-outline-color': '#343434',
                    'fill-opacity': 0.7
                },
                'source-layer': 'EA_FloodMapForPlanningRiversa-9hc3gv'
            });
    });

    function onSelectLayers(value) {
            const checkbox = $(`#${value}_check`)
            const isVisible = checkbox.prop('checked')
            console.log(isVisible, 'isVisible');
            if (isVisible === false) {
                if (value === 'FloodDefence') {
                     map.setLayoutProperty('FloodDefence', 'visibility', 'none');
                    $('#HiddenLine2').hide();

                } 
                else if (value === 'HistoricalFlood') {
                     map.setLayoutProperty('HistoricalFlood', 'visibility', 'none');
                     $('#HiddenLine3').hide();
                }
               
                else if (value === 'LondonFloodRiskAreas') {
                     map.setLayoutProperty('LondonFloodRiskAreas', 'visibility', 'none');
                     $('#HiddenLine1').hide();

                }
                else if (value === 'AreasBenefitingfromDefences') {
                     map.setLayoutProperty('AreasBenefitingfromDefences', 'visibility', 'none');
                     $('#HiddenLine4').hide();

                }

            } else if (isVisible === true) {
                if (value === 'FloodDefence') {
                     map.setLayoutProperty('FloodDefence', 'visibility', 'visible');
                     $('#HiddenLine2').show();

                } 
                else if (value === 'HistoricalFlood') {
                     map.setLayoutProperty('HistoricalFlood', 'visibility', 'visible');
                     $('#HiddenLine3').show();
                }
               
                else if (value === 'LondonFloodRiskAreas') {
                     map.setLayoutProperty('LondonFloodRiskAreas', 'visibility', 'visible');
                     $('#HiddenLine1').show();

                }
                else if (value === 'AreasBenefitingfromDefences') {
                     map.setLayoutProperty('AreasBenefitingfromDefences', 'visibility', 'visible');
                     $('#HiddenLine4').show();

                }

            }
            // map.setLayoutProperty(value, 'visibility', isVisible === false ? 'none' : 'visible');
        }

        
    
</script>


<div class="headBox">
    <h1 class="headText"> London Flood and Flood defences </h1>
     </div>

<center class="map-overlay layerSelect" id="layerSelect">
    <h3 style="height: 8px;">Select Layers </h3>
    <div class="splitLine"></div>
    <form style="display: flex; flex-direction: column; align-items: flex-start;padding-left: 24px;" action=''
    method="get">
        <label><input id='LondonFloodRiskAreas_check' type="checkbox" value="LondonFloodRiskAreas" checked='true' class="checkbox"
            onchange="onSelectLayers(value)" />London Floood Risk Zones</label>
            <p id='HiddenLine1' style='display:visible;text-align:left;font-size:12px'> Flood Risk Areas defined by the Environment Agency and Lead Local Flood Authorities. Each cell is allocated one of four flood risk categories, taking into account flood defences and their condition.</p> 
        <label><input id='FloodDefence_check' type="checkbox" value="FloodDefence" class="checkbox"
            onchange="onSelectLayers(value)" />Flood Defences </label>
            <p id='HiddenLine2' style='display:none;text-align:left;font-size:12px'> Earth banks, stone and concrete walls and sheet-piling that is used to prevent or control the extent of flooding. Includes both man-made and natural defences. </p>
        <label><input id='HistoricalFlood_check' type="checkbox" value="HistoricalFlood" class="checkbox"
            onchange="onSelectLayers(value)" />Historic Flood </label>
            <p id='HiddenLine3' style='display:none;text-align:left;font-size:12px'> The maximum extent of individual Recorded Flood Outlines from river, the sea and groundwater springs that meet a set criteria. Records began in 1946.</p>
        <label><input id='AreasBenefitingfromDefences_check' type="checkbox" value="AreasBenefitingfromDefences" class="checkbox"
            onchange="onSelectLayers(value)" />Areas Benefiting from Defences </label>
            <p id='HiddenLine4' style='display:none;text-align:left;font-size:12px'> Areas that benefit from the presence of defences in a 1% chance of flooding from rivers; or 0.5 % chance of flooding from the sea each year. areas coverd by lower protection standard defences may not be mapped.</p>

        </form>
</center>

<div class="legendBox">
    <div class="graffiti_legend" id='graffiti_legend'><b> Legend </b>
        <div class="splitLine_legend"></div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #05aaf7;"></div><span class="legend-text">Very Low</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #0c5df4;"></div><span class="legend-text">Low</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #6436e4;"></div><span class="legend-text">Medium</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #7609f2;"></div><span class="legend-text">High</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #8e9292;"></div><span class="legend-text">NoData</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #d3f705;"></div><span class="legend-text">Flood Defences</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #ef0b0b;"></div><span class="legend-text">Historic Flood</span>
        </div>
        <div class="legend-sec-box ">
            <div class="legend-poi" style="background-color: #00ff1e;"></div><span class="legend-text">Areas Benefiting from Defences</span>
        </div>
    
    </div>

</body>
</html>