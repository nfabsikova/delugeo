<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Social Vulnerability to Floods in UK</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Fira+Sans&family=Work+Sans:wght@300;700&display=swap');    
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }

.map-overlay {
    font: 12px/20px 'Work Sans', sans-serif;
    position: absolute;
    width: 30%;
    top: 0;
    left: 0;
    padding: 10px;
    
    
}

.map-overlay .map-overlay-inner {
    background-color: #fff;
    box-shadow:0 1px 2px rgba(0, 0, 0, 0.20);
    border-radius: 3px;
    padding: 10px;
    margin-bottom: 10px;
    opacity: 0.9;
        background:#EFFFFF ;
    min-width: 250px;
}

.map-overlay table {
    border: none;
    width: 100%;
}
        
.map-overlay h1 {
    line-height: 15px;
    font-size: 15px;
    display: block;
    margin: 0 0 10px;
}

        
.map-overlay h2 {
    line-height: 24px;
    display: block;
    margin: 0 0 10px;
}

.map-overlay label {
    font: 11px 'Work Sans', Arial, Helvetica, sans-serif;
    vertical-align: bottom;
    margin: 0;
    padding: 0;
}

.map-overlay .legend .bar {
    height: 20px;
    width: 100%;
    background: linear-gradient(to right, #4DB9D7,#ffffff, #6E016B);
}

.map-overlay input {
    display: inline;
    vertical-align: middle;
    margin: 5px;
    padding: 0;
}

.map-overlay p.credit {
   margin: 5px 0 0 0;
   padding: 0;
}

    </style>
</head>
<body>



<div id='map'></div>

<div class='map-overlay'>
    <div class='map-overlay-inner'>
        <h2>Social Vulnerability to Floods in UK</h2>
                <table>
            <tr>
                <td>
                    <input
                        checked
                        id="vul_button"
                        name="layers"
                        type="radio"
                        value="vul"
                    >
                    <label><b>Overall Vulnerability Index</b></label>
                </td>
            </tr>
            <tr>
                <td>
                    <input
                        id="sus_button"
                        name="layers"
                        type="radio"
                        value="sus"
                    >
                        <label>Human Susceptibility</label>
                </td>
            </tr>
            <tr>
                <td>
                    <input
                        id="pre_button"
                        name="layers"
                        type="radio"
                        value="pre"
                    >
                        <label>Inability to Prepare</label>
                </td>
            </tr>
            <tr>
                <td>
                    <input
                        
                        id="res_button"
                        name="layers"
                        type="radio"
                        value="res"
                    >
                        <label>Inability to Respond</label>
                </td>
            </tr>
            <tr>
                <td>
                    <input
                        id="rec_button"
                        name="layers"
                        type="radio"
                        value="rec"
                    >
                        <label>Inability to Recover</label>
                </td>
            </tr>
            <tr>
                <td>
                    <input
                        id="com_button"
                        name="layers"
                        type="radio"
                        value="com"
                    >
                        <label>Lack of Community Support</label>
                </td>
            </tr>    
         <tr><td><p class="cityfly"> Fly To:
             <a href="#" class="citylink" id="lond">London</a>  &nbsp;
             <a href="#" class="citylink" id="manc">Manchester</a> &nbsp;             
             <a href="#" class="citylink" id="birm">Birmingham</a>&nbsp;
             <a href="#" class="citylink" id="leed">Leeds</a> &nbsp;
             <a href="#" class="citylink" id="glas">Glasgow</a></p>
         </td></tr>
         </table>
 <input
                        id="pop_button"
                        name="layers"
                        type="checkbox"
                        value="pop"
                    >
                        <label>Show Population Weighted Centroids</label>
         <p class="credit">Source: <a href="https://www.climatejust.org.uk/">Climate Just, 2018</a>;&nbsp; <a href="https://data.gov.uk/dataset/a40f54f7-b123-4185-952f-da90c56b0564/lower-layer-super-output-areas-december-2011-population-weighted-centroids/">LSOA Population Weighted Centroids, 2011;</a>&nbsp; <a href="https://geoportal.statistics.gov.uk/datasets/ons::urban-audit-functional-urban-areas-december-2016-super-generalised-clipped-boundaries-in-the-united-kingdom/explore?location=54.177803%2C-3.250000%2C6.00">Urban Audit Functional Urban Areas, 2016</a>.</p>
</div>

    <div class="map-overlay-inner">
<div id="legend" class="legend">
    <div><h1>About The Map</h1>
        Social vulnerability to floods can be divided into five aspects. The overall index is an aggregate of five indices calculated by indicators and normalized to Z-Scores.<br>
        The map plots the UK's vulnerability index at the LSOA level for analysing and comparing sources of social vulnerability.<br>&nbsp;&nbsp; 
    </div>
<div class="bar"></div>
<div>Min  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Max</div>
</div>
</div>
         <div class="map-overlay-inner">
        <h1 id="RegionName">Hover over a Region</h1> <!--Initial RegionName Value-->
                  <h1 id="NVFI"></h1> 
         <table>
         <tr><td><p>
         <a id="NVFI_SUS"></a>  &nbsp;<br>
         <a id="NVFI_PRP"></a>  &nbsp;<br>
         <a id="NVFI_RES"></a>  &nbsp;<br>
         <a id="NVFI_REC"></a>  &nbsp;<br>
         <a id="NVFI_COM"></a> </p>
         </td></tr>
         </table>
</div>   
</div>



    
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiaHVhbmd4aW55MSIsImEiOiJjbDJ6NTEwbnMxYnM4M2RsYm5sdmU4bGJsIn0.tBOCOLwkj52n4MxZgWUTXw';  //Put your mapbox access token here

        // Load a new map in the 'map' HTML div
        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/huangxiny1/cl300j0p1000d14mk3xmnqnkd', // Put your mapbox style ID here
            center: [-0.1, 51.5], // starting position [lng, lat]
            zoom: 8 // starting zoom
        });
    
     var NVFI = {
        property: 'NVFI',
        type: 'exponential',
        stops: [
            [-1.6659884, '#4DB9D7'],
            [0, '#ffffff'],
            [2.5158128, '#6E016B']] };
    
     var sus = {
        property: 'NVFI_SUS',
        type: 'exponential',
        stops: [
            [-2.4201196, '#4DB9D7'],
            [0, '#ffffff'],
            [2.4495136, '#6E016B']] };
    
     var pre = {
        property: 'NVFI_PRP',
        type: 'exponential',
        stops: [
            [-1.4617088, '#4DB9D7'],
            [0, '#ffffff'],
            [2.729396, '#6E016B']] };
    
     var res = {
        property: 'NVFI_RES',
        type: 'exponential',
        stops: [
            [-1.587572, '#4DB9D7'],
            [0, '#ffffff'],
            [2.5871776, '#6E016B']] };

     var rec = {
        property: 'NVFI_REC',
        type: 'exponential',
        stops: [
            [-1.52917, '#4DB9D7'],
            [0, '#ffffff'],
            [2.6927816, '#6E016B']] };

     var com = {
        property: 'NVFI_COM',
        type: 'exponential',
        stops: [
            [-1.8568624, '#4DB9D7'],
            [0, '#ffffff'],
            [2.9703496, '#6E016B']] };

        map.on('load', function() {
        map.addLayer({ 
            id: 'NVFI_layer', // The unique name for the layer
            type: 'fill', // Solid block polygons
            source: {
                type: 'vector', // Vector tiles
                url: 'mapbox://huangxiny1.b9qe84t5' // Tileset ID
                },
                'source-layer': 'CJ2017_NFVI_SRFI_Full_Dataset-7h8xrf', //  Tileset Name
                'layout': {
                'visibility': 'visible'}, // Not an invisible layer
            paint: {
                'fill-color': NVFI, // This is the initial variable being mapped (changable)
                'fill-opacity': 1 }
        });

// Add the label layer
	map.addLayer({
		'id': 'labels',
		'type': 'symbol',
        source: {
          type: 'vector',
          url: 'mapbox://huangxiny1.0yy8fey6' // Your Mapbox tileset Map ID
        },
		'source-layer': 'Urban_Audit_Functional_Urban_-4pfsj8', // name of tilesets
		'layout': {
            'symbol-avoid-edges':true,
			'text-field': ['get','uafua16nm'],
			'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
			'text-size': 16,
            'text-variable-anchor':["center"]
		},
		'paint': {
			'text-color': 'rgba(0,0,0,0.8)',
			'text-halo-color': '#fff',
			'text-halo-width': 0.5
		}
	});   

 map.addLayer({ 
            id: 'boundaries_1', // The unique name for the layer
            type: 'line', 
        source: {
          type: 'vector',
          url: 'mapbox://huangxiny1.0yy8fey6' // Your Mapbox tileset Map ID
        },
		'source-layer': 'Urban_Audit_Functional_Urban_-4pfsj8', // name of tilesets
                'layout': {}, 
            paint: {
                'line-color':'#133b1c',
                'line-width':1.5
            }
        });
            
 map.addLayer({ 
            id: 'population', // The unique name for the layer
            type: 'circle', 
        source: {
          type: 'vector',
          url: 'mapbox://huangxiny1.5l717bod' // Your Mapbox tileset Map ID
        },
		'source-layer': 'Lower_Layer_Super_Output_Area-0a3ane', // name of tilesets
                'layout': {}, 
            paint: {
                 'circle-opacity': 0,
                'circle-radius':1.5,
                'circle-color':'#5C65A6'
            }
        });
            document.getElementById('RegionName').innerHTML = "Hover over a LSOA!"
            document.getElementById('NVFI').innerHTML = 'Overall Vulnerability Index: ';
            document.getElementById('NVFI_COM').innerHTML = 'Lack of Community Support: Housing Characteristics, Direct Flood Experience, Service Availability & Social Networks ';
            document.getElementById('NVFI_PRP').innerHTML = 'Inability to Prepare: Income, Information Use, Local Knowledge & Tenure';
            document.getElementById('NVFI_REC').innerHTML = 'Inability to Recover: Income, Information Use, Local Knowledge, Physical Mobility & Crime';
            document.getElementById('NVFI_RES').innerHTML = 'Inability to Respond: Income, Information Use & Physical Mobility';
            document.getElementById('NVFI_SUS').innerHTML = 'Human Susceptibility: Age & Health ';  
            document.getElementById('NVFI').style.color = '#000000';
            document.getElementById('NVFI_REC').style.color = '#000000';
            document.getElementById('NVFI_RES').style.color = '#000000';
            document.getElementById('NVFI_SUS').style.color = '#000000';
            document.getElementById('NVFI_PRP').style.color = '#000000';
            document.getElementById('NVFI_COM').style.color = '#000000';
           
document.getElementById("vul_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',NVFI);
});
document.getElementById("sus_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',sus);
});
document.getElementById("pre_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',pre);
});
document.getElementById("res_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',res);
});
document.getElementById("rec_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',rec);
});
document.getElementById("com_button").addEventListener("click", function(){
map.setPaintProperty('NVFI_layer','fill-color',com);
});
document.getElementById("pop_button").addEventListener("click", function(){
    if (this.checked) {
map.setPaintProperty('population', 'circle-opacity',0.9);
    } else {
map.setPaintProperty('population', 'circle-opacity',0);
    };

});

      map.on('mousemove', function(e) {
                var la = map.queryRenderedFeatures(e.point, {
                layers: ['NVFI_layer'] });
           if (la.length>=1) { 
            document.getElementById('RegionName').innerHTML ='LSOA Name: '+ la[0].properties.NAME;
            document.getElementById('NVFI').innerHTML ='Overall Vulnerability Index: '+ la[0].properties.NVFI;
            document.getElementById('NVFI_PRP').innerHTML ='Inability to Prepare: '+ la[0].properties.NVFI_PRP;
            document.getElementById('NVFI_COM').innerHTML ='Lack of Community Support: '+ la[0].properties.NVFI_COM;
            document.getElementById('NVFI_REC').innerHTML ='Inbility to Recover: '+ la[0].properties.NVFI_REC;
            document.getElementById('NVFI_RES').innerHTML ='Inbility to Respond: '+ la[0].properties.NVFI_RES;
            document.getElementById('NVFI_SUS').innerHTML ='Human Susceptibility: '+ la[0].properties.NVFI_SUS;
            if (la[0].properties.NVFI < 0) {   
                            document.getElementById('NVFI').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI').style.color = '#6E016B';
                        };
            if (la[0].properties.NVFI_COM < 0) {   
                            document.getElementById('NVFI_COM').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI_COM').style.color = '#6E016B';
                        };
            if (la[0].properties.NVFI_SUS < 0) {   
                            document.getElementById('NVFI_SUS').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI_SUS').style.color = '#6E016B';
                        };
            if (la[0].properties.NVFI_PRP < 0) {   
                            document.getElementById('NVFI_PRP').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI_PRP').style.color = '#6E016B';
                        };
             if (la[0].properties.NVFI_REC < 0) {   
                            document.getElementById('NVFI_REC').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI_REC').style.color = '#6E016B';
                        };
            if (la[0].properties.NVFI_RES < 0) {   
                            document.getElementById('NVFI_RES').style.color = '#4DB9D7';
                        } else {document.getElementById('NVFI_RES').style.color = '#6E016B';
                        };               
           }
          else{document.getElementById('RegionName').innerHTML = "Hover over a LSOA!"
             document.getElementById('NVFI').innerHTML = 'Overall Vulnerability Index: ';
            document.getElementById('NVFI_COM').innerHTML = 'Lack of Community Support: Housing Characteristics, Direct Flood Experience, Service Availability & Social Networks ';
            document.getElementById('NVFI_PRP').innerHTML = 'Inability to Prepare: Income, Information Use, Local Knowledge & Tenure';
            document.getElementById('NVFI_REC').innerHTML = 'Inability to Recover: Income, Information Use, Local Knowledge, Physical Mobility & Crime';
            document.getElementById('NVFI_RES').innerHTML = 'Inability to Respond: Income, Information Use & Physical Mobility';
            document.getElementById('NVFI_SUS').innerHTML = 'Human Susceptibility: Age & Health ';  
            document.getElementById('NVFI').style.color = '#000000';
            document.getElementById('NVFI_REC').style.color = '#000000';
            document.getElementById('NVFI_RES').style.color = '#000000';
            document.getElementById('NVFI_SUS').style.color = '#000000';
            document.getElementById('NVFI_PRP').style.color = '#000000';
            document.getElementById('NVFI_COM').style.color = '#000000';
              };
        });
            
//Event listener for the zoom to buttons created using a for loop and switch case statement to set lat and long
var x = document.getElementsByClassName('citylink');
var i;
		for (i = 0; i < x.length; i++) {
			x[i].addEventListener('click', function(e) {

				var lat,long;

				switch(e.target.id) {
					case "birm": long=-1.8904; lat=52.4862; break;
					case "bris": long=-2.5879; lat=51.4545; break;
					case "leed": long=-1.5491; lat=53.8008; break;
					case "lond": long=-0.1278; lat=51.5074; break;
					case "manc": long=-2.2426; lat=53.4808; break;
					case "newc": long=-1.6178; lat=54.9783; break;
                    case "card": long=-3.1790; lat=51.4815; break;
                    case "glas": long=-4.2514; lat=55.8609; break;
				}

				map.flyTo({
					center: [long,lat],
					zoom: 8.5,
					speed: 0.7,
					pitch: 0
					});
			});
		}
});
</script>

</body>
</html>